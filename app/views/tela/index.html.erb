<h1>Próximo número:</h1>

<h1 id="numero"><%= @rodada.posicao_atual if @rodada %></h1>
<h1 id="nome"><%= @rodada.aluno_atual.nome if @rodada and @rodada.aluno_atual %></h1>

<label for="matricula">Matrícula:</label>
<input type="text" name="matricula" id="matricula">
<button id="btnMatricula">Inscrever</button>

<script type="text/javascript">
  function insereMatricula() {
    var matricula = $("#matricula").val();
    $.post("<%= tela_inscrever_path %>", { matricula: matricula })
      .done(function () { alert("Adicionado com sucesso"); })
      .fail(function () { alert("Erro"); });
  }
  $("#btnMatricula").click(insereMatricula);
  $("#matricula").keypress(function (e) {
    if (e.which == 13 || e.keyCode == 13) {
        insereMatricula();
        return false;
    }
    return true;
  });
</script>

<% if false %>
<!-- 
<%= form_with(model: @aluno, url: tela_inscrever_path) do |form| %>
  <div class="field">
    <%= form.label :matricula %>
    <%= form.text_field :matricula %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
 -->
<% end %>

<script type="text/javascript">
document.addEventListener("turbolinks:load", function () {
  
  App.room = App.cable.subscriptions.create("TelaoNotificationsChannel", {
    received: function(data) {
      document.getElementById('numero').innerText = data.posicao_atual;
      document.getElementById('nome').innerText = data.nome_aluno_atual;
      return console.log(data);
    }
  });

});
</script>